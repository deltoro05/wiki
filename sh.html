<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>シェルスクリプト | hydrocul のメモ</title>
<link rel="stylesheet" href="https://raw.github.com/necolas/normalize.css/master/normalize.css" type="text/css" />
<link rel="stylesheet" href="./common/css/page.css" type="text/css" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script src="./common/js/page.js"></script>
</head>
<body>

<div id="breadcrumb">
  シェルスクリプト
</div>
<div id="side-menu">
  <div id="side-menu-attention">
    このサイトは筆者(hydrocul)の個人メモの集合です。
  </div>
  <div id="side-menu-ls">
    <ul>
  <li><a href="./">Home</a></li>
  <li>&gt; <a href="./apache.html">Apache</a></li>
  <li>&gt; <a href="./codeigniter.html">CodeIgniter</a></li>
  <li>&gt; <a href="./commands/">コマンドリファレンス</a></li>
  <li>&gt; <a href="./css.html">CSS</a></li>
  <li>&gt; <a href="./emacs.html">Emacs</a></li>
  <li>&gt; <a href="./google.html">google</a></li>
  <li>&gt; <a href="./google-analytics.html">Google Analytics</a></li>
  <li>&gt; <a href="./html.html">HTML</a></li>
  <li>&gt; <a href="./incron.html">incron (inotify cron)</a></li>
  <li>&gt; <a href="./iptables.html">iptables</a></li>
  <li>&gt; <a href="./java.html">Java</a></li>
  <li>&gt; <a href="./jquery.html">jQuery</a></li>
  <li>&gt; <a href="./linux.html">Linux</a></li>
  <li>&gt; <a href="./linux-pkg-manager.html">Linuxでのパッケージ管理</a></li>
  <li>&gt; <a href="./mac.html">Mac</a></li>
  <li>&gt; <a href="./markdown.html">Markdown</a></li>
  <li>&gt; <a href="./mechanize.html">mechanize</a></li>
  <li>&gt; <a href="./memcached.html">memcached</a></li>
  <li>&gt; <a href="./misc.html">misc</a></li>
  <li>&gt; <a href="./mosh.html">mosh</a></li>
  <li>&gt; <a href="./mysql.html">MySQL</a></li>
  <li>&gt; <a href="./oneliner.html">ワンライナー</a></li>
  <li>&gt; <a href="./paco.html">Paco (pacKAGE oRGANIZER)</a></li>
  <li>&gt; <a href="./passenger.html">Passenger (Ruby on Rails)</a></li>
  <li>&gt; <a href="./phantomjs.html">phantomjs</a></li>
  <li>&gt; <a href="./php.html">PHP</a></li>
  <li>&gt; <a href="./programming_languages_diff/">プログラミング言語の比較</a></li>
  <li>&gt; <a href="./rails.html">Ruby on Rails</a></li>
  <li>&gt; <a href="./ruby.html">Ruby</a></li>
  <li>&gt; シェルスクリプト</li>
  <li>&gt; <a href="./svn.html">Subversion (svn)</a></li>
  <li>&gt; <a href="./tmux.html">tmux</a></li>
  <li>&gt; <a href="./ubuntu.html">Ubuntu</a></li>
</ul>

  </div>
</div>

<div id="content">
  <h1 id="sh">シェルスクリプト</h1>

<h2 id="84d5235">シェルスクリプトファイルの実体のあるディレクトリの絶対パスをシェルスクリプト自身が取得するには
<span class="article-date">2013/04/03</span></h2>

<pre><code># シェルスクリプトの絶対パスを取得
SCRIPT_HOME=$0

if [ -n "`readlink $SCRIPT_HOME`" ] ; then
    # そのパスがシンボリックリンクの場合
    # シンボリックリンクのリンク先を取得
    SCRIPT_HOME="`readlink $SCRIPT_HOME`"
fi

# 取得したパスのディレクトリを取得
SCRIPT_HOME="`dirname $SCRIPT_HOME`"
</code></pre>

<h2 id="72b4dfc">シェルスクリプトに与えられた任意の数の引数を繰り返し処理するには
<span class="article-date">2013/04/03</span></h2>

<p>以下のようにする。</p>

<pre><code>for f in "$@"; do
    echo "$i"
done
</code></pre>

<p>以下は <code>shift</code> を使った例。</p>

<pre><code>while [ -n "$1" ]; do
    echo "$1"
    shift
done
</code></pre>

<p><code>shift</code> で、<code>$2</code> にあったものが <code>$1</code> に入るなど、引数が1つずつずれる。<code>shift</code> でも <code>$0</code> は変わらない。</p>

<h2 id="fc2cf5a">シェルスクリプトに与えられた引数をすべて特定のコマンドに渡すには
<span class="article-date">2013/04/03</span></h2>

<p>例えば <code>ls</code> に渡すには</p>

<pre><code>ls "$@"
</code></pre>

<p>これでシェルスクリプトに <code>a b "c d"</code> と引数を渡すと <code>ls "a" "b" "c d"</code> が実行される。</p>

<pre><code>ls "$*"
</code></pre>

<p>とすると、<code>ls "a b c d"</code> が実行されてしまう。</p>

<h2 id="06deedf">一定の確率でなにかをするには
<span class="article-date">2013/04/18</span></h2>

<p>シェルスクリプト実行時に、10分の1の確率でなにもしないようにするには、シェルスクリプトの先頭に以下のように書く。</p>

<pre><code>if [ `expr $RANDOM % 10` -ne 0 ] ; then
    exit
fi
</code></pre>

<p><code>$RANDOM</code> は参照するごとに乱数を返す変数のようなもの。<code>expr</code> で、10の剰余を計算している。</p>

<p>Ubuntu 12.04 でのデフォルトの /bin/sh が dash になっていて、<code>$RANDOM</code> が動かないので、これを使う場合はshebangを <code>#!/bin/bash</code> にする。</p>

<h2 id="ca5290e">bash, dash の比較
<span class="article-date">2013/04/18</span></h2>

<p><a href="http://www.01.246.ne.jp/~hatch/sh.html" target="_blank">http://www.01.246.ne.jp/~hatch/sh.html</a></p>

<p>dash は Ubuntu 12.04 でのデフォルトの /bin/sh になっている。</p>

<h2 id="9813095">変数の内容を比較して分岐させるには
<span class="article-date">2013/04/18</span></h2>

<pre><code>a=...
if [ "$a" = "abc" ]; then
    ...
fi
</code></pre>

<h2 id="operator">演算子
<span class="article-date">2013/08/23</span></h2>

<dl>
  <dt>文字列1 <code>=</code> 文字列2</dt>
  <dd>文字列が等しい場合</dd>
  <dt>文字列1 <code>!=</code> 文字列2</dt>
  <dd>文字列が等しくない場合</dd>
  <dt><code>-z</code> 文字列</dt>
  <dd>空文字列の場合</dd>
  <dt><code>-n</code> 文字列</dt>
  <dd>長さ1以上の文字列の場合</dd>
  <dt>数値1 <code>-eq</code> 数値2</dt>
  <dd>数値が等しい場合</dd>
  <dt>数値1 <code>-ne</code> 数値2</dt>
  <dd>数値が等しくない場合</dd>
  <dt>数値1 <code>-lt</code> 数値2</dt>
  <dd>数値が <code>&lt;</code> の関係</dd>
  <dt>数値1 <code>-le</code> 数値2</dt>
  <dd>数値が <code>&lt;=</code> の関係</dd>
  <dt>数値1 <code>-ge</code> 数値2</dt>
  <dd>数値が <code>&gt;=</code> の関係</dd>
  <dt>数値1 <code>-gt</code> 数値2</dt>
  <dd>数値が <code>&gt;</code> の関係</dd>
  <dt><code>-e</code> ファイル名</dt>
  <dd>ファイルまたはディレクトリが存在する場合。
Perlでも同じ。
-&gt; <a href="programming_languages_diff/io/file-exists.html">ファイルまたはディレクトリの有無を取得するには</a></dd>
  <dt><code>-f</code> ファイル名</dt>
  <dd>ファイルが通常のファイルとして存在する場合。
Perlでも同じ。</dd>
  <dt><code>-d</code> ファイル名</dt>
  <dd>ファイルがディレクトリとして存在する場合。
Perlでも同じ。</dd>
  <dt><code>-L</code> ファイル名</dt>
  <dd>ファイルがシンボリックリンクとして存在する場合。
Perlでは <code>-l</code> を使う。
-&gt; <a href="programming_languages_diff/io/is-empty.html">ファイルサイズが0かどうかを取得するには</a></dd>
  <dt><code>-s</code> ファイル名</dt>
  <dd>ファイルサイズが0より大きい場合。
Perlでも同じ。
-&gt; <a href="programming_languages_diff/io/is-symbolic-link.html">シンボリックリンクかどうかを取得するには</a></dd>
  <dt><code>-x</code> ファイル名</dt>
  <dd>ファイルが実行可能な場合。
Perlでも同じ。</dd>
  <dt>ファイル名1 <code>-nt</code> ファイル名2</dt>
  <dd>ファイル1のほうが新しい場合</dd>
  <dt>ファイル名1 <code>-ot</code> ファイル名2</dt>
  <dd>ファイル1のほうが古い場合</dd>
</dl>

<h2 id="205a015">特殊な変数
<span class="article-date">2013/04/25</span></h2>

<dl>
  <dt><code>$*</code></dt>
  <dd>シェルスクリプトに渡された引数。<code>"$*"</code> と書くと、引数が複数ある場合に、<code>"param1 param2 param3"</code> のように、全部をスペースでつなげた1つの文字列になる。</dd>
  <dt><code>$@</code></dt>
  <dd>シェルスクリプトに渡された引数。<code>"$@"</code> と書くと、引数が複数ある場合に、<code>"param1" "param2" "param3"</code> のようになる。</dd>
  <dt><code>$1</code>, <code>$2</code>, <code>$3</code>, …</dt>
  <dd>シェルスクリプトに渡された引数</dd>
  <dt><code>$0</code></dt>
  <dd>シェルスクリプトのファイル名</dd>
  <dt><code>$?</code></dt>
  <dd>最後に実行したコマンドの終了コード</dd>
  <dt><code>$!</code></dt>
  <dd>直前に起動したバックグラウンドプロセスのプロセスID。バックグラウンドプロセスは、最後に <code>&amp;</code> を付けて起動させる。</dd>
  <dt><code>$$</code></dt>
  <dd>シェルスクリプト自身のプロセスID</dd>
</dl>

<h2 id="71e2645">永久ループを書くには
<span class="article-date">2013/08/20</span></h2>

<pre><code>while : ; do date; sleep 1; done
</code></pre>

<p>-&gt; <a href="programming_languages_diff/control_flow/while.html#sh">while文</a></p>

<h2 id="051fd10">zsh の分かりにくい記号、用語のまとめ
<span class="article-date">2013/05/01</span></h2>

<p><a href="http://qiita.com/items/26a9ddcb7470f539e575" target="_blank">http://qiita.com/items/26a9ddcb7470f539e575</a></p>

<h2 id="20e5530">複数のコマンドを並べる記号 <code>;</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>||</code>
<span class="article-date">2013/06/03</span></h2>

<p>複数のコマンドを <code>;</code>, <code>&amp;</code>, <code>&amp;&amp;</code>, <code>||</code> で挟んで並べることで、いろいろな条件で複数のコマンドを実行させられる。</p>

<dl>
  <dt><code>;</code></dt>
  <dd>コマンドを順番に無条件に実行する。前のコマンドが終了してから次のコマンドを実行する。</dd>
  <dt><code>&amp;</code></dt>
  <dd>前のコマンドをバックグラウンドジョブとして起動して、続けて次のコマンドを実行する。並列処理になる。</dd>
  <dt><code>&amp;&amp;</code></dt>
  <dd>前のコマンドが成功した場合に限り、次のコマンドを実行する。成功というのは、終了ステータスが0を返した場合。</dd>
  <dt><code>||</code></dt>
  <dd>前のコマンドが失敗した場合に限り、次のコマンドを実行する。失敗というのは、終了ステータスが0以外を返した場合。</dd>
</dl>

<h2 id="fda876c">エスケープ処理</h2>

<p>-&gt; programming_languages_diff/string.md#escape</p>

<h2 id="62032f2">sudoでリダイレクトするには(root権限でしか書き込めないファイルにリダイレクトするには)
<span class="article-date">2013/06/17</span></h2>

<pre><code>sudo hogehoge &gt; /etc/foo/bar
</code></pre>

<p>とやっても /etc/foo/bar への一般ユーザでの書き込み権限がないと、
permission denied と言われてしまうので、以下のようにする。</p>

<pre><code>sudo sh -c "hogehoge &gt; /etc/foo/bar"
</code></pre>

<p>teeを使って以下のようにしてもよい。この場合、画面にも出力が表示される。
hogehoge自体にroot権限が不要な場合は、1つ目のsudoを外せる。</p>

<pre><code>sudo hogehoge | sudo tee /etc/foo/bar
</code></pre>


</div>

<footer>
  <a href="./">目次</a>
  <!-- Copyright &copy; 2012- @hydrocul All Rights Reserved. -->
</footer>

</body>
</html>
