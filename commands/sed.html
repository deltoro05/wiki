<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>sed コマンド | コマンドの使い方 | hydrocul のメモ</title>
<meta name="google-site-verification" content="uOXuLX4TAlCnMv26zOR30sGJVaZeWwaQLijOrxZiDyI" />
<link rel="stylesheet" href="https://raw.github.com/necolas/normalize.css/master/normalize.css" type="text/css" />
<link rel="stylesheet" href="../common/css/page.css" type="text/css" />
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js"></script>
<script src="https://rawgithub.com/adobe-webplatform/Snap.svg/master/dist/snap.svg-min.js"></script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script src="../common/js/page.js"></script>
</head>
<body>

<div id="breadcrumb">
  <a href="../commands/">コマンドの使い方</a> &gt; <span>sed コマンド</span>
</div>
<div id="side-menu">
  <div id="side-menu-attention">
    このサイトは筆者(hydrocul)の個人メモの集合です。
  </div>
  <div id="side-menu-ls">
    <ul>
  <li><a href="../commands/">コマンドの使い方</a>
    <ul>
      <li><a href="../commands/ack-grep.html">ack-grep コマンド</a></li>
      <li><a href="../commands/adduser.html">adduser / useradd コマンド</a></li>
      <li><a href="../commands/awk.html">awk コマンド</a></li>
      <li><a href="../commands/base64.html">base64 コマンド</a></li>
      <li><a href="../commands/cat.html">cat コマンド</a></li>
      <li><a href="../commands/cp.html">cp コマンド</a></li>
      <li><a href="../commands/crontab.html">crontab コマンド</a></li>
      <li><a href="../commands/curl.html">curl コマンド</a></li>
      <li><a href="../commands/cut.html">cut コマンド</a></li>
      <li><a href="../commands/date.html">date コマンド</a></li>
      <li><a href="../commands/diff.html">diff コマンド</a></li>
      <li><a href="../commands/du.html">du コマンド</a></li>
      <li><a href="../commands/find.html">find コマンド</a></li>
      <li><a href="../commands/git.html">git コマンド</a></li>
      <li><a href="../commands/grep.html">grep コマンド</a></li>
      <li><a href="../commands/incrontab.html">incron (inotify cron) (incrontab コマンド)</a></li>
      <li><a href="../commands/less.html">less コマンド</a></li>
      <li><a href="../commands/lftp.html">lftp コマンド</a></li>
      <li><a href="../commands/lha.html">lha コマンド</a></li>
      <li><a href="../commands/ls.html">ls コマンド</a></li>
      <li><a href="../commands/lscpu.html">lscpu コマンド</a></li>
      <li><a href="../commands/md5sum.html">md5sum コマンド</a></li>
      <li><a href="../commands/mosh.html">mosh コマンド</a></li>
      <li><a href="../commands/netstat.html">netstat コマンド</a></li>
      <li><a href="../commands/nkf.html">nkf コマンド</a></li>
      <li><a href="../commands/od.html">od コマンド</a></li>
      <li><a href="../commands/openssl.html">openssl コマンド</a></li>
      <li><a href="../commands/paco.html">Paco (pacKAGE oRGANIZER)</a></li>
      <li><a href="../commands/ps.html">ps コマンド</a></li>
      <li><a href="../commands/pstree.html">pstree コマンド</a></li>
      <li><a href="../commands/rsync.html">rsync コマンド</a></li>
      <li><a href="../commands/sdiff.html">sdiff コマンド</a></li>
      <li>sed コマンド</li>
      <li><a href="../commands/sha1sum.html">sha1sum コマンド</a></li>
      <li><a href="../commands/siege.html">siege コマンド</a></li>
      <li><a href="../commands/sort.html">sort コマンド</a></li>
      <li><a href="../commands/source-highlight.html">source-highlight コマンド</a></li>
      <li><a href="../commands/sqlite.html">sqlite3 コマンド</a></li>
      <li><a href="../commands/ssh.html">ssh コマンド</a></li>
      <li><a href="../commands/sshfs.html">sshfs コマンド</a></li>
      <li><a href="../commands/tac.html">tac コマンド</a></li>
      <li><a href="../commands/tail.html">tail コマンド</a></li>
      <li><a href="../commands/tar.html">tar コマンド</a></li>
      <li><a href="../commands/tee.html">tee コマンド</a></li>
      <li><a href="../commands/time.html">time コマンド</a></li>
      <li><a href="../commands/tmux.html">tmux コマンド</a></li>
      <li><a href="../commands/top.html">top コマンド</a></li>
      <li><a href="../commands/touch.html">touch コマンド</a></li>
      <li><a href="../commands/tr.html">tr コマンド</a></li>
      <li><a href="../commands/watch.html">watch コマンド</a></li>
      <li><a href="../commands/wc.html">wc コマンド</a></li>
      <li><a href="../commands/wget.html">wget コマンド</a></li>
      <li><a href="../commands/wkhtmltoimage.html">wkhtmltoimage コマンド</a></li>
      <li><a href="../commands/xargs.html">xargs コマンド</a></li>
      <li><a href="../commands/zip.html">zip / unzip コマンド</a></li>
    </ul>
  </li>
</ul>

  </div>
</div>

<div id="content">
  <h1 id="sed">sed コマンド
<span class="article-date">2013/06/17</span></h1>

<p>文字列を全置換したり、行単位で削除したり、いろいろできるコマンド。</p>

<h2 id="1db04e2">基本的な使い方
<span class="article-date">2013/10/26</span></h2>

<p>標準入力を処理して標準出力に出力する。またはファイル名を指定すればそのファイルを読み込んで標準出力に出力する。ファイル名を指定してオプション <code>-i</code> を使えば、そのファイルを読み込んで、結果をそのファイルに上書きする。処理内容はオプション <code>-e</code> で指定する。</p>

<p>パイプで使う場合の例</p>

<pre><code>cat -e ./hoge.txt | sed -e 's/xxx/XXX/g' &gt; ./hoge-new.txt
</code></pre>

<p>ファイル名を指定して使う場合の例</p>

<pre><code>sed -e 's/xxx/XXX/g' ./hoge.txt &gt; ./hoge-new.txt
</code></pre>

<p>ファイルを書き換えてしまう例(複数のファイルを指定できる)</p>

<pre><code>sed -i -e 's/xxx/XXX/g' ./hoge.txt ./hoge2.txt ./hoge3.txt
</code></pre>

<p><code>-e</code>オプションを複数指定すれば、コマンドを複数実行することができる。またはコマンドを <code>;</code> で区切って複数並べることもできる。</p>

<p>コマンドが複数ある場合、コマンド1つずつ全行操作するのではなく、各行ごとにコマンドをすべて実行していく。</p>

<p>例えば <code>sed -n -e '11,20!d' -e 6,15p</code> または <code>sed -n -e '11,20!d;6,15p</code> は、
11行目から20行目以外を削除するコマンドと、
6行目から15行目のみを抽出するコマンドだが、これは、11行目から20行目以外を削除した結果に対して6行目から15行目を抽出する(つまりトータルでは16行目から20行目のみを抽出する)のではなく、
11行目から20行目と6行目から15行目が重なる行、つまり11行目から15行目のみを抽出する。</p>

<h3 id="4ac7902"><code>s</code>コマンド
<span class="article-date">2013/10/01</span></h3>

<p><a href="../programming_languages_diff/regexp/replace-all.html#sed">正規表現で置換</a>をする。</p>

<h3 id="63c6a61"><code>d</code>コマンド
<span class="article-date">2013/10/01</span></h3>

<p>行を削除する。</p>

<p><code>sed d</code> とすると、すべての行が削除されてなにも出力しなくなってしまう。通常は後述のアドレスの機能を使って削除する行を指定して、残りを出力させる。</p>

<pre><code># 1行目から5行目を削除して6行目以降を出力
sed 1,5d
</code></pre>

<p><code>!</code> を付けると、逆に対象行以外を削除するコマンドになる。</p>

<pre><code># 1行目から行目のみを出力
# ! はシェルが特別に解釈してしまうので、
# シングルクオーテーションを付けるか \ でエスケープが必要
sed '1,5!d'
sed 1,5\!d
</code></pre>

<h3 id="10e0c12"><code>p</code>コマンド
<span class="article-date">2013/10/01</span></h3>

<p>行を単に出力する。通常は <code>-n</code> オプションと組み合わせる。
<code>sed</code>コマンドでは処理結果をデフォルトで出力するが、
<code>-n</code> オプションを付けるとデフォルトの出力がされなくなり、
<code>p</code>コマンドの出力のみになる。</p>

<h3 id="f03a24c">アドレス
<span class="article-date">2013/10/01</span></h3>

<p>コマンドの実行対象行を指定する行番号をアドレスという。行番号だけでなくや正規表現で指定することもできる。</p>

<p>以下の例はすべて<code>p</code>コマンドでの例だが、<code>s</code>, <code>y</code>, <code>d</code> コマンドなどでも使える。</p>

<pre><code># 先頭の行のみを出力
sed -n -e 1p

# 最後の行のみを出力
# \ はシェルのエスケープ
sed -n -e \$p

# 6行目から15行目を出力
sed -n -e 6,15p

# 奇数行のみを出力
sed -n -e 1~2p

# 1行目、6行目、11行目、16行目、、、を出力
sed -n -e 1~5p

# 正規表現にマッチする行を出力
sed -n -e /xxx/p

# 正規表現にマッチする行を出力
sed -n -e /xxx/p

# 正規表現にマッチする行を出力
# 先頭に \ を付ければ、正規表現を囲む記号はなんでもよい
sed -n -e '\%xxx%p'

# 正規表現にマッチする行から3行分を出力
# 正規表現にマッチするごとに最低3行が出力される
sed -n -e /xxx/,+3p

# 20行目から23行目までの4行分を出力
sed -n -e 20,+3p
</code></pre>

<h2 id="f63e1b3">正規表現の中で ‘{}’ を使うには
<span class="article-date">2013/06/17</span></h2>

<p>正規表現で文字数を指定する <code>{}</code> は <code>\</code> でエスケープしないと使えないようだ。</p>

<pre><code>sed 's/x{4}/XXXX/g'       # =&gt; NG
sed 's/x\{4\}/XXXX/g'     # =&gt; OK
sed "s/x{4}/XXXX/g"       # =&gt; NG
sed "s/x\{4\}/XXXX/g"     # =&gt; OK
sed "s/x\\\{4\\\}/XXXX/g" # =&gt; NG
</code></pre>

<h2 id="group">正規表現の中の <code>()</code> で囲まれた部分を使って置換するには
<span class="article-date">2013/10/22</span></h2>

<p>置換後の文字列には、<code>\1</code>, <code>\2</code> などを指定することで、正規表現にマッチしたグループに置き換えられる。</p>

<pre><code>echo "bc abcc" | sed 's/b\(c*\)/\1/g'
# =&gt; c acc

echo "bc abcc" | sed -e 's/b\(c*\)/\1/g'
# =&gt; c acc

echo "bc abcc" | sed -E 's/b(c*)/\1/g'
# =&gt; c acc
</code></pre>

<p>正規表現の中の <code>()</code> には <code>\</code> でエスケープしないといけないみたい。でもなぜか 
<code>-E</code> をつけると、エスケープが不要みたい。</p>

<h2 id="a7c5547">タブ文字を全置換するには
<span class="article-date">2013/06/17</span></h2>

<pre><code># タブ文字をスペースに全置換
sed '/\t/ /g'
</code></pre>

<h2 id="3c28adf">正規表現にマッチする行を削除するには
<span class="article-date">2013/06/17</span></h2>

<pre><code># '2013' が含まれる行を削除
sed '/^2013/d'

# 空行を削除
sed '/^$/d'
</code></pre>

<h2 id="9fce4d9">正規表現にマッチする行を抽出するには
<span class="article-date">2013/09/25</span></h2>

<pre><code># '2013' が含まれる行のみを出力
sed '/^2013/!d'
# または
sed -n '/^2013/p'

# 空行の数をカウント
sed -n '/^$/p' | wc -l
</code></pre>

<h2 id="85210e2">1つ以上の連続するスペースまたはタブ文字を1つのスペースに全置換するには
<span class="article-date">2013/06/17</span></h2>

<pre><code># タブ文字をスペースに全置換
sed -E '/[\t ]+/ /g'
</code></pre>

<h2 id="99dcc4b">標準入力ではなくファイルの中のテキストを全置換してファイルを置き換えるには
<span class="article-date">2013/06/17</span></h2>

<pre><code>sed -i -e 's/置換前/置換後/g' ファイル名
</code></pre>

<p><code>-i</code> を取ると、全置換後の結果を標準出力に吐き出して、ファイルは書き換えない。</p>

<p><code>-e</code> はどういう意味だろう？</p>

<h3 id="find-sed-recursive">ディレクトリの中にあるたくさんのファイルの文字列を全置換するには
<span class="article-date">2013/12/20</span></h3>

<p>置換対象のファイルを <a href="find.html"><code>find</code></a> などでリストアップして、 <code>sed</code> を使う。</p>

<pre><code>find . -name "*.txt" | xargs sed -i 's/置換前/置換後/g'
</code></pre>

<p>または</p>

<pre><code>find . -name "*.txt" -exec sed -i 's/置換前/置換後/g' {} \;
</code></pre>

<p><code>find</code> でマッチしたファイルのほとんどが置換されるならこれでもいいと思うが、ごく一部のファイルだけであれば <a href="grep.html"><code>grep</code></a> を使って以下のようにしたほうがいいかもしれない。</p>

<pre><code>grep -rl 置換前  | xargs sed -i 's/置換前/置換後/g'
</code></pre>

<p>-&gt; <a href="http://d.hatena.ne.jp/hydrocul/20111211/1323595015" target="_blank">http://d.hatena.ne.jp/hydrocul/20111211/1323595015</a></p>

<h2 id="843a0db">2つ以上の全置換を一括で実行するには
<span class="article-date">2013/06/17</span></h2>

<p><code>-e</code> で2つ以上の全置換を実行できる。</p>

<pre><code>cat ファイル名 | sed -e 's/置換前/置換後/g' -e 's/別の置換前/別の置換後/g'
</code></pre>

<h2 id="bc7f63d">行番号で指定する範囲のみを抽出するには
<span class="article-date">2013/06/14</span></h2>

<pre><code># 2行目から4行目を抽出(4行目を含む)
cat ファイル名 | sed -n 2,4p

# 2行目のみを抽出
cat ファイル名 | sed -n 2p

# 2行目から最後まで抽出
cat ファイル名 | sed -n '2,$p'
# または
cat ファイル名 | sed -n 2,\$p
</code></pre>

<h2 id="c845011">行番号で指定する範囲のみを削除するには
<span class="article-date">2013/06/14</span></h2>

<pre><code># 2行目から4行目を削除(4行目も削除)
cat ファイル名 | sed -e 2,4d

# 2行目のみを削除
cat ファイル名 | sed -e 2d

# 2行目から最後まで削除
cat ファイル名 | sed -e '2,$d'
# または
cat ファイル名 | sed -e 2,\$d
# または head でも同じことができる
cat ファイル名 | head -n 1

# 最後の行のみを削除
cat ファイル名 | sed -e \$d
</code></pre>

<h2 id="1f85bb3">パスなどを全置換する際にスラッシュをエスケープするのが面倒な場合
<span class="article-date">2013/06/18</span></h2>

<p><code>s/.../..../g</code> の記法のスラッシュは記号なら比較的なんでもよくて、3つ同じ記号を使っていることに意味があるので、<code>s@...@...@g</code> のようにも書ける。</p>

<p>例</p>

<pre><code>cat ファイル名 | sed -e 's@/etc/foo/bar@/home/my/etc/foo/bar@g'
</code></pre>

<h2 id="5e23def">ログファイルなどの <code>tail -f</code> の出力をsedで処理しながら表示するには
<span class="article-date">2013/07/09</span></h2>

<pre><code>tail -f access_log | sed --unbuffered ...
</code></pre>

<p><code>--unbuffered</code> を付けないとsedがバッファリングをしてしまって、リアルタイムに表示されなくなってしまう。</p>

<h2 id="ecac355">空行を削除するには
<span class="article-date">2013/09/11</span></h2>

<p><code>^$</code> という正規表現と、<code>d</code>での削除コマンドを使う。</p>

<pre><code>cat ファイル名 | sed '/^$/d'
</code></pre>

<p>空白文字だけの行も空行とみなして削除するには、</p>

<pre><code>cat ファイル名 | sed '/^[[:blank:]]*$/d'
</code></pre>

</div>

<footer>
  <a href="../">目次</a>
  <!-- Copyright &copy; 2012- @hydrocul All Rights Reserved. -->
</footer>

</body>
</html>
